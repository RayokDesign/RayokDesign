<nav class="navbar navbar-light pt-3">
    <div class="container">
        <h1><a href="/restaurant" class="navbar-brand">RayokTailand</a></h1>
        <!-- Button trigger modal -->
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
            <i class="bi bi-plus-circle"></i>
        </button>

        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <form action="/restaurant?date=<%= date[0]+'-'+date[1] %>" method="post" class="pt-3">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Record</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                        <div class="d-flex expinRadio">
                            <div class="form-check me-3 mb-3">
                                <input class="form-check-input" type="radio" name="expin" id="expense" value="expense" checked>
                                <label class="form-check-label" for="expense">
                                    Expense
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="expin" id="income" value="income">
                                <label class="form-check-label" for="income">
                                    Income
                                </label>
                            </div>
                        </div>
                        <!-- ITEMS -->
                        <select class="form-select mb-3" name="item" required>
                            <option selected value="">Select a item</option>
                            <% for (item in items) { %>
                                <option value="<%= item %>"><%= items[item].name %></option>
                            <% } %>
                        </select>
                        <!-- CATEGORIES -->
                        <select class="form-select mb-3" name="category" required>
                            <option selected value="">Select a category</option>
                            <% for (category in categories) { %>
                                <option value="<%= category %>"><%= categories[category].name %></option>
                            <% } %>
                        </select>
                        <div class="input-group mb-3">
                            <input class="form-control" name="amount" type="number" required="required" placeholder="0">
                            <span class="input-group-text">à¸¿</span>
                        </div>
                        <input class="form-control mb-3" name="date" type="date" value="<%- moment(new Date()).format('YYYY-MM-DD') %>" required="required">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
            </div>
            </div>
        </div>
        <!-- /Modal -->
        <div class="d-flex">
            <% if (uid){ %>
                <a href="/member/user" class="btn btn-primary me-2">User</a>
                <a href="/member/signout" class="btn btn-secondary">Signout</a>
            <% } else { %>
                <a href="/member/signin" class="btn btn-primary me-2">Signin</a>
                <a href="/member/signup" class="btn btn-secondary">Signup</a>
            <% } %>
        </div>
    </div>
</nav>
<div class="container pt-3">
    <header class="mb-3">
        <!-- CHOOSE MONTH -->
        <form action="/restaurant" method="get" id="date">
            <input class="form-control mb-3" type="month" name="date" onchange="document.getElementById('date').submit()" value="<%= date[0]+'-'+date[1] %>">
        </form>
        <!-- /CHOOSE MONTH -->
        
        <!-- MONTH RECORD -->
        <ul class="list-group list-group-flush mb-3">
            <li class="list-group-item d-flex justify-content-between"><span>Inflow</span><span><%= amountFormat(inflow) %></span></li>
            <li class="list-group-item d-flex justify-content-between"><span>Outflow</span><span><%= amountFormat(outflow) %></span></li>
            <li class="list-group-item d-flex justify-content-between mt-1"><span class="fw-bold"></span>
                <% if (inflow+outflow > 0) { %>
                    <span class="fw-bold text-primary"><%= amountFormat(inflow + outflow) %></span>
                <% } else if (inflow+outflow < 0) { %>
                    <span class="fw-bold text-danger"><%= amountFormat(inflow + outflow) %></span>
                <% } else { %>
                    <span class="fw-bold"><%= amountFormat(inflow + outflow) %></span>
                <% } %>
            </li>
        </ul>
        <!-- /MONTH RECORD -->
        <!-- TOTAL COST -->
        <div class="accordion" id="details">
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingThree">
                <button class="accordion-button collapsed px-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    Total cost of categories
                </button>
              </h2>
              <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                <div class="accordion-body p-0">
                    <ul id="monthStatistics" class="list-group list-group-flush">
                        <% for (totalcost in monthStatistics) { %>
                        <li class="list-group-item d-flex justify-content-between">
                            <span class="text-capitalize"><%= categories[totalcost].name %></span>
                            <% if (monthStatistics[totalcost] > 0) { %>
                                <span class="text-primary">+<%= amountFormat(monthStatistics[totalcost]) %></span>
                            <% } else if (monthStatistics[totalcost] < 0) { %>
                                <span class="text-danger"><%= amountFormat(monthStatistics[totalcost]) %></span>
                            <% } else { %>
                                <span><%= amountFormat(monthStatistics[totalcost]) %></span>
                            <% } %>
                        </li>
                        <% } %>
                    </ul>
                </div>
              </div>
            </div>
          </div>
        <hr>
        <!-- /TOTAL COST -->
    </header>
    <!-- SHOW RECORDS -->
    <section>
        <% for (day in data) { %>
        <div class="card mb-3" >
            <!-- RECORD'S DATE -->
            <div class="card-header d-flex justify-content-between">
                <span><%= moment(data[day].time).format('DD dddd YYYY MMMM') %></span>
                <% if (dayStatistics[day] > 0) { %>
                    <span class="fw-bold text-primary"><%= amountFormat(dayStatistics[day]) %></span>
                <% } else if (dayStatistics[day] < 0) { %>
                    <span class="fw-bold text-danger"><%= amountFormat(dayStatistics[day]) %></span>
                <% } else { %>
                    <span class="fw-bold"><%= amountFormat(dayStatistics[day]) %></span>
                <% } %>
            </div>
            <!-- /RECORD'S DATE -->

            <!-- RECORD'S DETAIL -->
            <div class="card-body p-0">
                <% for (record in data[day].records) { %>
                <div class="accordion accordion-flush" id="accordionCategory">
                    <div class="accordion-item">
                        <!-- CATEGORY HEAD -->
                        <h2 class="accordion-header d-flex">
                            <button class="accordion-button collapsed px-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapse<%= day+record %>" aria-expanded="true" aria-controls="<%= record %>">
                                <%= categories[record].name %>
                            </button>
                            <span class="fs-6 p-3 text-nowrap w-25 text-end">
                                <%= amountFormat(categoryStatistics[record+day]) %>
                            </span>
                        </h2>
                        <!-- /CATEGORY HEAD -->
                        <!-- ITEM HEAD -->
                        <div id="collapse<%= day+record %>" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionCategory">
                            <div class="accordion-body p-0">
                                <ul class="list-group list-group-flush">
                                    <% for (item in data[day].records[record]) { %>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span class="text-capitalize"><a href="javascript:;" class="me-3 text-danger" data-bs-toggle="modal" data-bs-target="#deleteItemModal" data-bs-whatever=<%= `/restaurant?deleteitem=${date[0]}-${date[1]}-${day}-${record}-${item}` %>><i class="bi bi-x-circle"></i></a><%= items[item].name %></span>    
                                        <% if (data[day].records[record][item].expin == "income") { %>
                                        <span class="text-primary">+<%= amountFormat(data[day].records[record][item].amount) %></span>
                                        <% } else { %>
                                        <span class="text-danger">-<%= amountFormat(data[day].records[record][item].amount) %></span>
                                        <% } %>
                                    </li>
                                    <% } %>
                                </ul>
                            </div>
                        </div>
                        <!-- /ITEM HEAD -->
                        <!-- DeleteItemModal -->
                        <div class="modal fade" id="deleteItemModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Warning</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        Delete this item?
                                    </div>
                                    <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <a href="" type="button" class="btn btn-primary">Delete</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /DeleteItemModal -->
                    </div>
                </div>
                <% } %>
            </div>
            <!-- RECORD'S DETAIL -->
        </div>
        <% } %>
    </section>
    <!-- /SHOW RECORDS -->
</div>
<script>
    var deleteItemModal = document.getElementById('deleteItemModal')
    deleteItemModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget
        var recipient = button.getAttribute('data-bs-whatever')
        var modalDeleteButton = deleteItemModal.querySelector('.modal-footer a')

        modalDeleteButton.href = recipient
    })
</script>